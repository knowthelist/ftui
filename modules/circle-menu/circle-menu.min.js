export class CircleMenu{constructor(t,s){const e={depth:1,item_diameter:100,circle_radius:6,angle:{start:0,end:90},speed:500,delay:1e3,step_out:20,step_in:-20,trigger:"hover",close_event:"click",transition_function:"ease"};this._timeouts=[],this.element=t,this.options=Object.assign({},e,s),this._defaults=e,this.init(),this.hook()}init(){this.menu_items=this.element.querySelectorAll("*:not(:first-child)"),this.firstItem=this.element.querySelector("*:first-child"),this.submenus=[];const t={vertical:[-400,0],"vertical-top":[-800,0],"horizontal-right":[400,0],"horizontal-left":[800,0],horizontal:[400,0],"bottom-left":[180,90],bottom:[135,45],right:[-45,45],left:[225,135],top:[225,315],"bottom-half":[180,0],"right-half":[-90,90],"left-half":[270,90],"top-half":[180,360],"top-left":[270,180],"top-right":[270,360],full:[-90,270-Math.floor(360/this.menu_items.length)],"bottom-right":[0,90]};if(this._state="closed",this.element.classList.add("closed"),"string"==typeof this.options.direction){const s=t[this.options.direction.toLowerCase()];s&&(this.options.angle.start=s[0],this.options.angle.end=s[1])}this.initCss(),this.item_count=this.menu_items.length,this._step=(this.options.angle.end-this.options.angle.start)/(this.item_count-1),this.menu_items.forEach((t,s)=>{const e=(this.options.angle.start+this._step*s)*(Math.PI/180),i=.75*this.options.circle_radius;let o=Math.round(this.options.circle_radius*Math.cos(e)),n=Math.round(this.options.circle_radius*Math.sin(e));this.options.angle.start<-360&&(o=0,n=s*i+i),this.options.angle.start<-790&&(o=0,n=-(s*i+.75*i)),this.options.angle.start>360&&(o=s*i+i,n=0),this.options.angle.start>790&&(o=-(s*i+i),n=0),t.posX=o-1.5,t.posY=n-1.5,t.addEventListener(this.options.close_event,()=>{this.select(s+2)})}),["open","close","init","select"].forEach(t=>{let s;this.options[t]&&(s=this.options[t],this.element.addEventListener(t,t=>s.apply(this,[t.detail])),delete this.options[t])}),this.menu_items.forEach(t=>{const s=t.querySelectorAll("ul");s&&s.length&&(this.submenus.push(s),s.cm=new CircleMenu(s,Object.assign((this.options,{depth:this.options.depth+1}))))}),this.trigger("init")}trigger(){const t=new CustomEvent(arguments[0],{detail:arguments[1]});this.element.dispatchEvent(t)}hook(){"hover"===this.options.trigger?(this.element.addEventListener("mouseenter",()=>{this.open()}),this.element.addEventListener("mouseleave",()=>{this.close()})):"click"===this.options.trigger&&this.firstItem?this.firstItem.addEventListener("click",t=>(t.preventDefault(),"closed"===this._state||"closing"===this._state?this.open():this.close(!0),!1)):this.options.trigger}open(){const t=0;let s;return this.clearTimeouts(),"open"===this._state?this:(this.element.classList.add("open"),this.element.classList.remove("closed"),this.firstItem.style.zIndex=parseInt(this.firstItem.style.zIndex)+100,s=this.options.step_out>=0?this.menu_items:[...this.menu_items].reverse(),s.forEach((s,e)=>{this._timeouts.push(setTimeout(()=>{s.style.left=s.posX+"em",s.style.top=s.posY+"em",s.style.transform="scale(1)",s.style.zIndex=parseInt(s.style.zIndex)+100}),t+Math.abs(this.options.step_out)*e)}),this._timeouts.push(setTimeout(()=>{"opening"===this._state&&this.trigger("open"),this._state="open"},t+Math.abs(this.options.step_out)*s.length)),this._state="opening",this)}close(t){const s=()=>{const t=0;let s;return this.submenus.forEach(t=>t.cm.close()),this.clearTimeouts(),"closed"===this._state?this:(s=this.options.step_in>=0?this.menu_items:[...this.menu_items].reverse(),s.forEach((s,e)=>{this._timeouts.push(setTimeout(()=>{s.style.top="-2em",s.style.left="-2em",s.style.transform="scale(0)",s.style.zIndex=parseInt(s.style.zIndex)-100},t+Math.abs(this.options.step_in)*e))}),this._timeouts.push(setTimeout(()=>{"closing"===this._state&&this.trigger("close"),this._state="closed"},t+Math.abs(this.options.step_in)*s.length)),this.element.classList.remove("open"),this.element.classList.add("closed"),this.firstItem.style.zIndex=parseInt(this.firstItem.style.zIndex)-100,this._state="closing",this)};return t?s():this._timeouts.push(setTimeout(s,this.options.delay)),this}select(t){if("open"===this._state||"opening"===this._state){this.clearTimeouts();const s=this.element.querySelectorAll("*:not(:nth-child("+t+")):not(:first-child)"),e=this.element.querySelector("*:nth-child("+t+")");this.trigger("select",e),this.menu_items.forEach(t=>{t.style.transition="all 500ms ease-out"}),e.style.transform="scale(2)",e.style.opacity=0,s.forEach(t=>{t.style.transform="scale(0)",t.style.opacity=0}),this.element.classList.remove("open"),setTimeout(()=>this.initCss(),500)}}clearTimeouts(){for(const t of this._timeouts)clearTimeout(t);this._timeouts=[]}initCss(){this._state="closed",this.element.classList.remove("open"),this.menu_items.forEach(t=>{t.style=null,t.style.top="-2em",t.style.left="-2em",t.style.transform="scale(0)",t.style.zIndex=1,t.style.opacity=null}),window.requestAnimationFrame(()=>{this.menu_items.forEach(t=>{t.style.transition="all "+this.options.speed+"ms "+this.options.transition_function})})}}